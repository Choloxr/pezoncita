<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Para Ti — Una sorpresa</title>

  <!-- Tipografías e íconos -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --bg-1: #0f1724;
      --bg-2: #201633;
      --glass: rgba(255,255,255,0.06);
      --accent: #ff6b9d;
      --accent-2: #ffd1dc;
      --muted: rgba(255,255,255,0.95);
      --radius: 14px;
      --card-w: 380px; /* optimizado para iPhone 11 */
      --transition: 220ms cubic-bezier(.2,.9,.2,1);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: 'Poppins', system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      background: radial-gradient(1000px 450px at 10% 10%, rgba(255,107,157,0.06), transparent 6%),
                  linear-gradient(135deg,var(--bg-1),var(--bg-2));
      color:var(--muted);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      -webkit-font-smoothing:antialiased;
      touch-action:manipulation;
    }

    .card{
      width:100%;
      max-width:var(--card-w);
      border-radius:calc(var(--radius) + 6px);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 12px 40px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      overflow:hidden;
      position:relative;
      border:1px solid rgba(255,255,255,0.06);
      -webkit-tap-highlight-color: transparent;
    }

    header{
      padding:20px 18px 28px 18px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:#fff;text-align:center;position:relative;
    }

    .logo{width:52px;height:52px;border-radius:10px;background:rgba(255,255,255,0.18);display:grid;place-items:center;font-size:20px;margin:0 auto}
    h1{font-family:'Playfair Display',serif;margin:10px 0 6px;font-size:22px}
    p.lead{margin:0;font-size:13px;opacity:0.96}

    main{padding:14px}
    .intro{background:var(--glass);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-bottom:12px;text-align:center}
    .intro p{margin:0;color:var(--muted);line-height:1.4;font-size:13px}

    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}

    .tile{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:12px;padding:16px;cursor:pointer;border:1px solid rgba(255,255,255,0.03);display:flex;gap:8px;align-items:center;justify-content:center;flex-direction:column;transition:transform var(--transition), box-shadow var(--transition);min-height:92px;-webkit-tap-highlight-color:transparent}
    .tile:focus{outline:3px solid rgba(255,107,157,0.12)}
    .tile:hover{transform:translateY(-6px);box-shadow:0 16px 30px rgba(2,6,23,0.45)}
    .tile i{font-size:24px;color:var(--accent-2)}
    .tile small{display:block;margin-top:8px;font-size:12px;color:rgba(255,255,255,0.95)}

    .message-box{margin-top:12px;padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,107,157,0.02), rgba(255,107,157,0.01));border:1px dashed rgba(255,107,157,0.05)}
    .message-text{font-style:italic;font-size:15px;color:#fff;min-height:46px;display:flex;align-items:center;justify-content:center;text-align:center;padding:6px}

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;justify-content:center}
    .btn{background:linear-gradient(135deg,var(--accent),var(--accent-2));border:none;color:white;padding:10px 14px;border-radius:999px;font-weight:600;cursor:pointer;box-shadow:0 8px 20px rgba(2,6,23,0.45);transition:transform var(--transition)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    footer{padding:12px;text-align:center;font-size:12px;color:rgba(255,255,255,0.75)}

    /* canvas escena */
    #scene{position:fixed;inset:0;pointer-events:none;z-index:10}

    /* corazones sutiles */
    .little-heart{position:absolute;opacity:0;transform:translateY(0);animation:floatUp 8s linear infinite;will-change:transform,opacity}
    @keyframes floatUp{0%{transform:translateY(40vh) scale(0.8);opacity:0}10%{opacity:0.9}90%{transform:translateY(-10vh) scale(1);opacity:0.6}100%{opacity:0}}

    /* flowers (SVG wrapper) */
    .flower{
      position:fixed;
      width:36px;
      height:36px;
      pointer-events:none;
      z-index:9999;
      opacity:0;
      will-change:transform,opacity;
      transform-origin:center;
    }

    /* Galería de fotos */
    .gallery-container {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 36, 0.95);
      z-index: 100;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }
    
    .gallery-image {
      max-width: 100%;
      max-height: 70vh;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
      object-fit: contain;
      transition: transform 0.3s ease;
      cursor: pointer;
    }
    
    .gallery-image.zoomed {
      transform: scale(1.8);
      cursor: zoom-out;
      z-index: 101;
    }
    
    .gallery-nav {
      display: flex;
      justify-content: space-between;
      width: 100%;
      max-width: 400px;
      margin-top: 20px;
    }
    
    .gallery-counter {
      color: white;
      font-size: 14px;
      margin: 15px 0;
    }
    
    .close-gallery {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.1);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .photo-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 15px;
    }
    
    .photo-container {
      position: relative;
      overflow: hidden;
      border-radius: 8px;
    }
    
    .photo-thumb {
      width: 100%;
      aspect-ratio: 1;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.5s ease;
      filter: blur(8px) brightness(0.7);
      transform: scale(0.9);
    }
    
    .photo-thumb.unlocked {
      filter: blur(0) brightness(1);
      transform: scale(1);
    }
    
    .photo-thumb.unlocked:hover {
      transform: scale(1.05);
      filter: brightness(1.1);
    }
    
    .lock-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 36, 0.7);
      border-radius: 8px;
      color: white;
      transition: all 0.5s ease;
      cursor: pointer;
    }
    
    .lock-overlay i {
      font-size: 32px;
      margin-bottom: 8px;
      color: var(--accent-2);
    }
    
    .lock-overlay span {
      font-size: 12px;
      text-align: center;
      padding: 0 10px;
    }
    
    .photo-container.unlocked .lock-overlay {
      opacity: 0;
      pointer-events: none;
    }
    
    .unlock-effect {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 8px;
      background: radial-gradient(circle, transparent 30%, var(--accent) 70%);
      opacity: 0;
      animation: unlockGlow 1s ease-out;
      pointer-events: none;
    }
    
    @keyframes unlockGlow {
      0% { opacity: 0.8; transform: scale(0.5); }
      100% { opacity: 0; transform: scale(2); }
    }
    
    .photo-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
      padding: 8px;
      font-size: 12px;
      border-radius: 0 0 8px 8px;
      transform: translateY(100%);
      transition: transform 0.3s ease;
      text-align: center;
    }
    
    .photo-container:hover .photo-caption {
      transform: translateY(0);
    }
    
    .photo-reactions {
      position: absolute;
      top: 8px;
      right: 8px;
      display: flex;
      gap: 5px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .photo-container.unlocked:hover .photo-reactions {
      opacity: 1;
    }
    
    .reaction-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      backdrop-filter: blur(5px);
      font-size: 14px;
    }
    
    .progress-container {
      width: 100%;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      margin: 15px 0 5px;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      border-radius: 3px;
      width: 0%;
      transition: width 0.5s ease;
    }
    
    .progress-text {
      text-align: center;
      font-size: 12px;
      color: rgba(255,255,255,0.8);
      margin-bottom: 10px;
    }

    @media (max-width:420px){
      :root{--card-w:92vw}
      h1{font-size:20px}
      .tile{min-height:88px;padding:14px}
      .message-text{font-size:14px}
      .intro p{font-size:13px}
      .grid{gap:8px}
      .photo-grid {
        grid-template-columns: 1fr;
      }
      .gallery-image.zoomed {
        transform: scale(1.5);
      }
    }

    @media (prefers-reduced-motion: reduce){*{animation-duration:0.001ms !important;animation-iteration-count:1 !important;transition-duration:0 !important}}
  </style>
</head>
<body>
  <canvas id="scene" aria-hidden="true"></canvas>

  <main class="card" role="region" aria-label="Tarjeta sorpresa">
    <header>
      <div class="logo" aria-hidden="true">💌</div>
      <h1>Para la gatita</h1>
      <p class="lead">Descubre nuestros recuerdos especiales</p>
    </header>

    <main>
      <div class="intro" id="intro">
        <p>Toca las fotos para desbloquear nuestros momentos especiales</p>
      </div>

      <div class="progress-text" id="progress-text">0/6 fotos desbloqueadas</div>
      <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
      </div>

      <div class="grid" role="list">
        <button class="tile" id="tile-type" role="listitem" aria-label="Tipo de mensaje" tabindex="0">
          <i class="fa-solid fa-keyboard"></i>
          <small>Mostrar mensaje (hay varios)</small>
        </button>

        <button class="tile" id="tile-hearts" role="listitem" aria-label="Lluvia de corazones" tabindex="0">
          <i class="fa-solid fa-heart"></i>
          <small>Toca acá para corazones</small>
        </button>

        <button class="tile" id="tile-fireworks" role="listitem" aria-label="Flores" tabindex="0">
          <i class="fa-solid fa-seedling"></i>
          <small>Toca acá para flores </small>
        </button>

        <button class="tile" id="tile-photos" role="listitem" aria-label="Nuestras fotos" tabindex="0">
          <i class="fa-solid fa-images"></i>
          <small>Ver galería completa</small>
        </button>
      </div>

      <div class="photo-grid">
        <div class="photo-container" data-index="0">
          <img src="img/1.jpg" alt="Nuestra foto 1" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Nuestro primer día juntos ❤️</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="0">❤️</button>
            <button class="reaction-btn" data-photo="0">😍</button>
          </div>
        </div>
        <div class="photo-container" data-index="1">
          <img src="img/2.jpg" alt="Nuestra foto 2" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Ese día fuimos a la playa 🌊</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="1">❤️</button>
            <button class="reaction-btn" data-photo="1">😍</button>
          </div>
        </div>
        <div class="photo-container" data-index="2">
          <img src="img/3.jpg" alt="Nuestra foto 3" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Celebrando tu cumpleaños 🎂</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="2">❤️</button>
            <button class="reaction-btn" data-photo="2">😍</button>
          </div>
        </div>
        <div class="photo-container" data-index="3">
          <img src="img/4.jpg" alt="Nuestra foto 4" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Nuestra primera cena especial 🍷</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="3">❤️</button>
            <button class="reaction-btn" data-photo="3">😍</button>
          </div>
        </div>
        <div class="photo-container" data-index="4">
          <img src="img/5.jpg" alt="Nuestra foto 5" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Ese viaje inolvidable ✈️</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="4">❤️</button>
            <button class="reaction-btn" data-photo="4">😍</button>
          </div>
        </div>
        <div class="photo-container" data-index="5">
          <img src="img/6.jpg" alt="Nuestra foto 6" class="photo-thumb">
          <div class="lock-overlay">
            <i class="fas fa-lock"></i>
            <span>Toca para descubrir este recuerdo</span>
          </div>
          <div class="photo-caption">Mi favorita de todas 💖</div>
          <div class="photo-reactions">
            <button class="reaction-btn" data-photo="5">❤️</button>
            <button class="reaction-btn" data-photo="5">😍</button>
          </div>
        </div>
      </div>

      <div class="message-box" aria-live="polite">
        <div id="message" class="message-text">Toca las fotos bloqueadas para descubrir nuestros recuerdos</div>
        <div class="controls" aria-hidden="true">
          <!-- controles vacíos intencionadamente para interfaz minimalista móvil -->
        </div>
      </div>

    </main>

    <footer>
      Cada recuerdo contigo es especial <span aria-hidden="true">💖</span>
    </footer>
  </main>

  <!-- Galería modal -->
  <div class="gallery-container" id="gallery">
    <button class="close-gallery" id="close-gallery">×</button>
    <img id="gallery-img" class="gallery-image" src="" alt="">
    <div class="gallery-counter" id="gallery-counter">1 / 6</div>
    <div class="gallery-nav">
      <button class="btn secondary" id="prev-btn">Anterior</button>
      <button class="btn" id="next-btn">Siguiente</button>
    </div>
  </div>

  <script>
    // ELEMENTOS
    const messageEl = document.getElementById('message');
    const tileType = document.getElementById('tile-type');
    const tileHearts = document.getElementById('tile-hearts');
    const tileFlowers = document.getElementById('tile-fireworks');
    const tilePhotos = document.getElementById('tile-photos');
    const scene = document.getElementById('scene');
    const gallery = document.getElementById('gallery');
    const galleryImg = document.getElementById('gallery-img');
    const galleryCounter = document.getElementById('gallery-counter');
    const closeGallery = document.getElementById('close-gallery');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const photoContainers = document.querySelectorAll('.photo-container');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const reactionBtns = document.querySelectorAll('.reaction-btn');

    const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

    // ESTADO DE FOTOS DESBLOQUEADAS
    let unlockedPhotos = JSON.parse(localStorage.getItem('unlockedPhotos')) || [];
    let currentPhotoIndex = 0;

    // GALERÍA
    const photos = [
      'img/1.jpg',
      'img/2.jpg',
      'img/3.jpg',
      'img/4.jpg',
      'img/5.jpg',
      'img/6.jpg'
    ];
    
    // Mensajes especiales para cada foto
    const photoMessages = [
      "Este día fue especial porque fue nuestra primera vez juntos",
      "Me encanta cuando vamos a la playa, eres tan feliz allí",
      "Tu sonrisa en tu cumpleaños iluminó todo el lugar",
      "Nuestra cena romántica, recuerdo cada detalle",
      "Este viaje fue mágico porque lo compartí contigo",
      "Esta foto es mi favorita porque captura nuestro amor"
    ];
    
    // Inicializar estado de fotos
    function initializePhotos() {
      photoContainers.forEach((container, index) => {
        const thumb = container.querySelector('.photo-thumb');
        
        if (unlockedPhotos.includes(index)) {
          // Foto ya desbloqueada
          container.classList.add('unlocked');
          thumb.classList.add('unlocked');
        } else {
          // Foto bloqueada
          container.classList.remove('unlocked');
          thumb.classList.remove('unlocked');
        }
      });
      
      updateProgress();
    }
    
    // Desbloquear una foto
    function unlockPhoto(index) {
      if (!unlockedPhotos.includes(index)) {
        unlockedPhotos.push(index);
        localStorage.setItem('unlockedPhotos', JSON.stringify(unlockedPhotos));
        
        const container = document.querySelector(`.photo-container[data-index="${index}"]`);
        const thumb = container.querySelector('.photo-thumb');
        
        // Efecto visual de desbloqueo
        const unlockEffect = document.createElement('div');
        unlockEffect.classList.add('unlock-effect');
        container.appendChild(unlockEffect);
        
        // Cambiar estado visual
        setTimeout(() => {
          container.classList.add('unlocked');
          thumb.classList.add('unlocked');
          unlockEffect.remove();
        }, 300);
        
        // Efectos especiales
        sparkles(12);
        createFlowerShower();
        
        // Mensaje especial
        typewriter(photoMessages[index], 36);
        
        // Actualizar progreso
        updateProgress();
        
        // Vibración en dispositivos móviles
        try{ if(navigator.vibrate) navigator.vibrate([100, 50, 100]); }catch(e){}
        
        // Mensaje especial si es la última foto
        if (unlockedPhotos.length === photos.length) {
          setTimeout(() => {
            typewriter('¡Has desbloqueado todos nuestros recuerdos! Te amo 💖', 40);
            rainHearts();
            sparkles(20);
          }, 2000);
        }
      }
    }
    
    // Actualizar barra de progreso
    function updateProgress() {
      const progress = (unlockedPhotos.length / photos.length) * 100;
      progressBar.style.width = `${progress}%`;
      progressText.textContent = `${unlockedPhotos.length}/${photos.length} fotos desbloqueadas`;
    }
    
    // Abrir galería solo con fotos desbloqueadas
    function openGallery() {
      if (unlockedPhotos.length === 0) {
        typewriter('Primero desbloquea algunas fotos tocándolas', 36);
        return;
      }
      
      // Mostrar la primera foto desbloqueada
      currentPhotoIndex = unlockedPhotos[0];
      updateGallery();
      gallery.style.display = 'flex';
      sparkles(8);
    }
    
    function updateGallery() {
      galleryImg.src = photos[currentPhotoIndex];
      galleryCounter.textContent = `${unlockedPhotos.indexOf(currentPhotoIndex) + 1} / ${unlockedPhotos.length}`;
      // Remover clase de zoom si estaba activa
      galleryImg.classList.remove('zoomed');
    }
    
    function nextPhoto() {
      const currentIndex = unlockedPhotos.indexOf(currentPhotoIndex);
      const nextIndex = (currentIndex + 1) % unlockedPhotos.length;
      currentPhotoIndex = unlockedPhotos[nextIndex];
      updateGallery();
    }
    
    function prevPhoto() {
      const currentIndex = unlockedPhotos.indexOf(currentPhotoIndex);
      const prevIndex = (currentIndex - 1 + unlockedPhotos.length) % unlockedPhotos.length;
      currentPhotoIndex = unlockedPhotos[prevIndex];
      updateGallery();
    }
    
    // Función para mostrar like en una foto
    function showLike(photoIndex) {
      if (!unlockedPhotos.includes(photoIndex)) return;
      
      const container = document.querySelector(`.photo-container[data-index="${photoIndex}"]`);
      const thumb = container.querySelector('.photo-thumb');
      
      // Efecto visual de like
      thumb.style.transform = 'scale(1.1)';
      setTimeout(() => {
        thumb.style.transform = 'scale(1)';
      }, 300);
      
      // Efectos visuales
      sparkles(8);
      rainHearts();
    }
    
    // Inicializar las fotos al cargar la página
    initializePhotos();

    // Eventos de la galería
    tilePhotos.addEventListener('click', openGallery);
    
    closeGallery.addEventListener('click', () => {
      gallery.style.display = 'none';
    });
    
    prevBtn.addEventListener('click', prevPhoto);
    nextBtn.addEventListener('click', nextPhoto);
    
    // Zoom en imagen de galería al hacer clic
    galleryImg.addEventListener('click', () => {
      galleryImg.classList.toggle('zoomed');
    });
    
    // Desbloquear fotos al hacer clic en el overlay
    photoContainers.forEach((container) => {
      const overlay = container.querySelector('.lock-overlay');
      const index = parseInt(container.getAttribute('data-index'));
      
      overlay.addEventListener('click', () => {
        unlockPhoto(index);
      });
      
      // También permitir desbloquear tocando la imagen misma si está bloqueada
      const thumb = container.querySelector('.photo-thumb');
      thumb.addEventListener('click', () => {
        if (!unlockedPhotos.includes(index)) {
          unlockPhoto(index);
        } else {
          // Si ya está desbloqueada, abrir la galería en esa foto
          currentPhotoIndex = index;
          updateGallery();
          gallery.style.display = 'flex';
        }
      });
    });
    
    // Botones de reacción
    reactionBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        const photoIndex = parseInt(this.getAttribute('data-photo'));
        showLike(photoIndex);
      });
    });
    
    // Cerrar galería con tecla Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && gallery.style.display === 'flex') {
        gallery.style.display = 'none';
      }
    });

    // TYPEWRITER
    function typewriter(text, speed = 40){
      messageEl.textContent = '';
      let i = 0;
      function step(){
        if(i <= text.length){
          messageEl.textContent = text.slice(0,i);
          i++;
          if(!reduceMotion) setTimeout(step, speed);
        }
      }
      step();
    }

    // MENSAJES: cariñosos y juguetones
    const messages = [
      'Sos muy linda',
      'Te quiero',
      'Te extraño',
      'Quiero verte',
      'Besito',
      'Sos gay',
    ];

    // ASIGNACIONES
    let messageIndex = 0; // Contador para seguir el orden

    if(tileType) tileType.addEventListener('click', () => {
      typewriter(messages[messageIndex], 36);
      sparkles(10);
      
      // Avanzar al siguiente mensaje, o volver al inicio
      messageIndex = (messageIndex + 1) % messages.length;
    });
    
    if(tileHearts) tileHearts.addEventListener('click', () => { 
      rainHearts(); 
      messageEl.textContent = 'Corazones para la gay'; 
      sparkles(6); 
    });
    
    // ahora tileFlowers crea flores en lugar de pétalos/confeti
    if(tileFlowers) tileFlowers.addEventListener('click', () => { 
      createFlowerShower(); 
      messageEl.textContent = 'Flores para la gay'; 
    });

    // TOUCH HEARTS
    function spawnHeart(x,y,emoji='❤'){
      const el = document.createElement('div');
      el.textContent = emoji;
      el.className = 'little-heart';
      el.style.left = (x - 18) + 'px';
      el.style.top = (y - 18) + 'px';
      el.style.fontSize = (14 + Math.random()*22) + 'px';
      el.style.opacity = Math.random() * 0.8 + 0.2;
      document.body.appendChild(el);
      setTimeout(()=>el.remove(), 7000);
      try{ if(navigator.vibrate) navigator.vibrate(8); }catch(e){}
    }

    function rainHearts(){
      const n = 20;
      for(let i=0;i<n;i++){
        setTimeout(()=>{
          const x = window.innerWidth * Math.random();
          const y = window.innerHeight * (0.2 + Math.random()*0.6);
          spawnHeart(x,y,['💖','💗','💕','💘'][Math.floor(Math.random()*4)]);
        }, i*90);
      }
    }

    // PARTICULAS (canvas)
    function sparkles(amount){
      if(reduceMotion) return;
      const w = scene.width = window.innerWidth; const h = scene.height = window.innerHeight;
      const ctx = scene.getContext('2d');
      if(!ctx) return;
      let particles = [];
      for(let i=0;i<amount;i++) particles.push({x:w/2 + (Math.random()-0.5)*200, y:h*0.35 + (Math.random()-0.5)*120, vx:(Math.random()-0.5)*6, vy:(Math.random()-0.5)*6, r:2+Math.random()*4, col:'hsl('+(Math.random()*360|0)+',70%,65%)'});
      let t=0;
      function frame(){
        ctx.clearRect(0,0,w,h);
        for(let p of particles){ p.x += p.vx; p.y += p.vy; p.vy += 0.06; p.r *= 0.99; ctx.beginPath(); ctx.fillStyle = p.col; ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
        t++; if(t<80) requestAnimationFrame(frame); else ctx.clearRect(0,0,w,h);
      }
      frame();
    }

    // FLOWERS: lightweight SVG-based flowers with smooth movement
    function createFlower(x = null, y = null, delay = 0) {
      const svgNS = 'http://www.w3.org/2000/svg';
      const wrapper = document.createElement('div');
      wrapper.className = 'flower';
      // default origin near center-top
      const ox = x !== null ? x : (window.innerWidth / 2 - 18 + (Math.random()*100-50));
      const oy = y !== null ? y : (window.innerHeight * 0.45 + (Math.random()*40-20));
      wrapper.style.left = ox + 'px';
      wrapper.style.top = oy + 'px';

      // create inline SVG
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('viewBox','0 0 100 100');
      svg.setAttribute('width','36'); svg.setAttribute('height','36');

      // center circle
      const center = document.createElementNS(svgNS, 'circle');
      center.setAttribute('cx','50'); center.setAttribute('cy','50'); center.setAttribute('r','8'); center.setAttribute('fill','#FFD1DC');
      center.setAttribute('stroke','#FF6B9D'); center.setAttribute('stroke-width','1');
      svg.appendChild(center);

      // petals (5)
      for(let i=0;i<5;i++){
        const petal = document.createElementNS(svgNS, 'ellipse');
        const angle = (i * (360/5)) * Math.PI / 180;
        const px = 50 + Math.cos(angle) * 26;
        const py = 50 + Math.sin(angle) * 26;
        petal.setAttribute('cx', px);
        petal.setAttribute('cy', py);
        petal.setAttribute('rx','10');
        petal.setAttribute('ry','16');
        petal.setAttribute('fill','#FF7FA5');
        petal.setAttribute('transform', `rotate(${i*72} 50 50)`);
        petal.setAttribute('opacity', '0.98');
        svg.appendChild(petal);
      }

      wrapper.appendChild(svg);
      document.body.appendChild(wrapper);

      const duration = 3200 + Math.random() * 2000; // 3.2s - 5.2s
      const tx = Math.random() * 220 - 110; // lateral drift
      const ty = - (window.innerHeight + 140); // go above top
      const rotate = (Math.random()*720 - 360);
      const scale = 0.9 + Math.random()*0.5;

      // initial transform
      wrapper.style.transform = `translate3d(0,0,0) rotate(${Math.random()*30-15}deg) scale(${scale})`;
      wrapper.style.opacity = '1';

      setTimeout(()=>{
        wrapper.style.transition = `transform ${duration}ms cubic-bezier(.2,.9,.2,1), opacity ${duration}ms linear`;
        wrapper.style.transform = `translate3d(${tx}px, ${ty}px,0) rotate(${rotate}deg) scale(${scale*0.9})`;
        wrapper.style.opacity = '0';
      }, delay);

      // cleanup
      setTimeout(()=>{ try{ wrapper.remove(); }catch(e){} }, duration + delay + 150);
    }

    function createFlowerShower(){
      if(reduceMotion) return;
      const cx = window.innerWidth/2;
      const cy = window.innerHeight*0.45;
      const count = 18;
      for(let i=0;i<count;i++){
        createFlower(
          cx + (Math.random()*240 - 120),
          cy + (Math.random()*80 - 40),
          i * 80
        );
      }
    }

    // Pointer interaction - leave a heart where touch/click happens
    function handlePointer(e){
      const x = (e.touches ? e.touches[0].clientX : e.clientX);
      const y = (e.touches ? e.touches[0].clientY : e.clientY);
      const targetTag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if(targetTag === 'button' || targetTag === 'svg' || (e.target && e.target.closest && e.target.closest('button'))) return;
      spawnHeart(x,y,['💖','💗','💕','💘'][Math.floor(Math.random()*4)]);
    }
    ['click','touchstart'].forEach(ev => document.addEventListener(ev, handlePointer, {passive:true}));

    // Floating background hearts (decoration)
    (function floatHearts(){
      for(let i=0;i<6;i++){
        const el = document.createElement('div');
        el.className = 'little-heart';
        el.style.left = (Math.random()*90) + 'vw';
        el.style.top = (60 + Math.random()*30) + 'vh';
        el.style.fontSize = (12 + Math.random()*28) + 'px';
        el.style.opacity = 0.12 + Math.random()*0.35;
        el.textContent = ['❤','💖','💗'][Math.floor(Math.random()*3)];
        el.style.animationDelay = (Math.random()*6) + 's';
        document.body.appendChild(el);
      }
    })();

    // Resize scene
    function resizeScene(){ scene.width = window.innerWidth; scene.height = window.innerHeight; }
    window.addEventListener('resize', resizeScene); resizeScene();

    // Keyboard accessibility: Enter / Space on tiles
    document.querySelectorAll('.tile').forEach(tile => {
      tile.addEventListener('keydown', (e) => { if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); tile.click(); } });
    });

    // Mensaje inicial breve
    setTimeout(()=>{ 
      if(messageEl.textContent.includes('Toc')) {
        if (unlockedPhotos.length === 0) {
          messageEl.textContent = 'Toca las fotos para descubrir nuestros recuerdos';
        } else {
          messageEl.textContent = 'Sigue descubriendo más fotos';
        }
      }
    }, 1200);
  </script>
</body>
</html>
